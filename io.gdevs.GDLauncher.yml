app-id: io.gdevs.GDLauncher
base: org.electronjs.Electron2.BaseApp
base-version: '20.08'
runtime: org.freedesktop.Sdk
runtime-version: '20.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk
command: gd.sh
build-options:
  env:
    PATH: /app/jre/bin:/usr/bin
finish-args:
  - --socket=x11
  - --share=ipc
  - --device=all   # controller support
  - --socket=pulseaudio
  - --share=network
  - --env=CHROME_WRAPPER=zypak-wrapper
  - --env=__NV_PRIME_RENDER_OFFLOAD=1
  - --env=__GLX_VENDOR_LIBRARY_NAME=nvidia
  - --filesystem=xdg-download   # downloaded/export resource packs etc.
modules:
  - name: openjdk
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk/install.sh
  - name: gdlauncher
    buildsystem: simple
    build-commands:
      - chmod +x GDLauncher-linux-setup.AppImage
      - ./GDLauncher-linux-setup.AppImage --appimage-extract
      - cp -r squashfs-root /app/bin/gdlauncher
      - install -D gdlauncherscaled.png /app/share/icons/hicolor/512x512/apps/io.gdevs.GDLauncher.png
      - install -D io.gdevs.GDLauncher.desktop /app/share/applications/io.gdevs.GDLauncher.desktop
      - install -D io.gdevs.GDLauncher.metainfo.xml /app/share/metainfo/io.gdevs.GDLauncher.appdata.xml
      - install -D gd.sh /app/bin
    sources:
      - type: file
        url: https://github.com/gorilla-devs/GDLauncher/releases/download/v1.1.11/GDLauncher-linux-setup.AppImage
        sha256: d52c97b577863eb35f787c9642f19a77b1a3873231da17634775623e3e36db65
        x-checker-data:
          type: json
          url: https://api.github.com/repos/gorilla-devs/GDLauncher/releases/latest
          version-query: .tag_name | sub("^[vV]"; "")
          url-query: |
            .assets[] | select(.name=="GDLauncher-linux-setup.AppImage") | .browser_download_url
      - type: file
        path: io.gdevs.GDLauncher.desktop
      - type: file
        path: gdlauncherscaled.png
      - type: file
        path: io.gdevs.GDLauncher.metainfo.xml
      - type: script
        commands:
          - zypak-wrapper /app/bin/gdlauncher/AppRun
        dest-filename: gd.sh
